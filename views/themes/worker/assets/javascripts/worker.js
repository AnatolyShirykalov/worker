!function(r){"function"==typeof define&&define.amd?define(["jquery"],r):r("object"==typeof exports?require("jquery"):jQuery)}(function(r){"use strict";function e(t,o){this.$element=r(t),this.options=r.extend({},e.DEFAULTS,r.isPlainObject(o)&&o),this.init()}var t="qor.worker",o="enable."+t,s="disable."+t,n="click."+t,a=".qor-worker--new",i=".qor-worker--show-errors",d=".qor-worker-form-list",l=".qor-worker--progress",c=".qor-js-table",u=".is-selected";return e.prototype={constructor:e,init:function(){this.bind(),r(l).size()&&r.fn.qorSliderAfterShow.updateWorkerProgress()},bind:function(){this.$element.on(n,r.proxy(this.click,this))},unbind:function(){this.$element.off(n,r.proxy(this.click,this))},click:function(t){var o=r(t.target);if(t.stopPropagation(),o.is(i)){var s=r(e.POPOVERTEMPLATE).appendTo("body"),n=r("tr.is-selected .qor-button--edit").attr("href");s.qorModal("show"),r.ajax({url:n,method:"GET",dataType:"html",processData:!1,contentType:!1}).done(function(e){var t=r(e).find(".qor-form-container"),o=t.find(".workers-error-output");o&&o.appendTo(s.find("#qor-worker-errors"))})}if(o.is(a)){var l=o.closest(d);r(d).removeClass("current"),l.addClass("current");var c=r(d).not(".current");c.find("form").addClass("hidden"),c.find(a).removeClass("open"),o.next("form").toggleClass("hidden"),o.toggleClass("open")}},destroy:function(){this.unbind(),e.getWorkerProgressIntervId&&window.clearInterval(e.getWorkerProgressIntervId),r.fn.qorSliderAfterShow.updateWorkerProgress=null}},e.DEFAULTS={},e.POPOVERTEMPLATE='<div class="qor-modal fade qor-modal--worker-errors" tabindex="-1" role="dialog" aria-hidden="true"><div class="mdl-card mdl-shadow--2dp" role="document"><div class="mdl-card__title"><h2 class="mdl-card__title-text">Process Errors</h2></div><div class="mdl-card__supporting-text" id="qor-worker-errors"></div><div class="mdl-card__actions"><a class="mdl-button mdl-button--colored mdl-js-button mdl-js-ripple-effect" data-dismiss="modal">close</a></div></div></div>',e.plugin=function(o){return this.each(function(){var s,n=r(this),a=n.data(t);if(!a){if(/destroy/.test(o))return;n.data(t,a=new e(this,o))}"string"==typeof o&&r.isFunction(s=a[o])&&s.apply(a)})},r.fn.qorSliderAfterShow.updateWorkerProgress=function(r){e.getWorkerProgressIntervId=window.setInterval(e.updateWorkerProgress,1e3,r)},e.updateTableStatus=function(e){var t=r(c).find(u),o=r(l).data().statusName;t.find('td[data-heading="'+o+'"]').find(".qor-table__content").html(e)},e.isScrollToBottom=function(r){return r.clientHeight+r.scrollTop===r.scrollHeight},e.updateWorkerProgress=function(t){var o=t,s=r(".workers-log-output"),n=r(".qor-worker--progress-value"),a=r(".qor-worker--progress-status"),i=r(l),d=r(c).find(u);if(i.size())var f=i.data();if(d.size())var p=d.find('td[data-heading="'+f.statusName+'"]').find(".qor-table__content").html();return i.size()&&i.size()&&"killed"!=f.status?f.progress>=100?(window.clearInterval(e.getWorkerProgressIntervId),document.querySelector("#qor-worker--progress").MaterialProgress.setProgress(100),e.updateTableStatus(f.status),r(".qor-workers-abort").addClass("hidden"),void r(".qor-workers-rerun").removeClass("hidden")):void r.ajax({url:o,method:"GET",dataType:"html",processData:!1,contentType:!1}).done(function(t){var o=r(t),i=o.find(l).data(),d=i.progress,c=i.status;n.html(d),a.html(c),document.querySelector("#qor-worker--progress").MaterialProgress.setProgress(d);var u,f=r.trim(s.html()),g=r.trim(o.find(".workers-log-output").html());g!=f&&(u=g.replace(f,""),e.isScrollToBottom(s[0])?s.append(u).scrollTop(s[0].scrollHeight):s.append(u)),p!=c&&e.updateTableStatus(c),d>=100&&(window.clearInterval(e.getWorkerProgressIntervId),r(".qor-workers-abort").addClass("hidden"),r(".qor-workers-rerun").removeClass("hidden"))}):void window.clearInterval(e.getWorkerProgressIntervId)},r(function(){var t='[data-toggle="qor.workers"]';r(document).on(s,function(o){e.plugin.call(r(t,o.target),"destroy")}).on(o,function(o){e.plugin.call(r(t,o.target))}).triggerHandler(o)}),e});
//# sourceMappingURL=worker.js.map
