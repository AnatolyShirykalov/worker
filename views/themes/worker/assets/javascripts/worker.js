"use strict";var _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e};!function(e){"function"==typeof define&&define.amd?define(["jquery"],e):e("object"===("undefined"==typeof exports?"undefined":_typeof(exports))?require("jquery"):jQuery)}(function(e){function r(t,o){this.$element=e(t),this.options=e.extend({},r.DEFAULTS,e.isPlainObject(o)&&o),this.init()}var t="qor.worker",o="enable."+t,n="disable."+t,s="click."+t,i=".qor-worker--new",d=".qor-worker-form",a=".qor-worker-form-list",l=".qor-worker--progress",u=".qor-worker-form--show",c=".qor-button--back",f=".qor-js-table",h=".is-selected";return r.prototype={constructor:r,init:function(){this.bind(),this.formOpened=!1,e(u).length&&(this.formOpened=!0)},bind:function(){this.$element.on(s,i,e.proxy(this.showForm,this)).on(s,c,e.proxy(this.hideForm,this))},unbind:function(){this.$element.off(s,i,this.showForm,this).off(s,c,this.hideForm,this)},hideForm:function(r){r.preventDefault();var t=this.$element,o=t.find(d).find(">li");o.show().removeClass("current").find("form").addClass("hidden"),e(c).addClass("hidden"),e(a).show(),this.formOpened=!1,window.onbeforeunload=null,e.fn.qorSlideoutBeforeHide=null},showForm:function(r){var t=e(r.target);if(r.preventDefault(),!this.formOpened){var o=t.closest("li"),n=t.closest(d),s=t.closest(a),i=n.find(">li");i.hide().removeClass("current"),o.addClass("current").show(),e(c).removeClass("hidden"),o.find(a).hide(),s.show().find("form").removeClass("hidden"),this.formOpened=!0}},destroy:function(){this.unbind(),r.getWorkerProgressIntervId&&window.clearInterval(r.getWorkerProgressIntervId)}},r.DEFAULTS={},r.POPOVERTEMPLATE='<div class="qor-modal fade qor-modal--worker-errors" tabindex="-1" role="dialog" aria-hidden="true">\n          <div class="mdl-card mdl-shadow--2dp" role="document">\n            <div class="mdl-card__title">\n              <h2 class="mdl-card__title-text">Process Errors</h2>\n            </div>\n          <div class="mdl-card__supporting-text" id="qor-worker-errors"></div>\n            <div class="mdl-card__actions">\n              <a class="mdl-button mdl-button--colored mdl-js-button mdl-js-ripple-effect" data-dismiss="modal">close</a>\n            </div>\n          </div>\n        </div>',r.plugin=function(o){return this.each(function(){var n,s=e(this),i=s.data(t);if(!i){if(/destroy/.test(o))return;s.data(t,i=new r(this,o))}"string"==typeof o&&e.isFunction(n=i[o])&&n.apply(i)})},e.fn.qorSliderAfterShow.updateWorkerProgress=function(t){e(".workers-log-output").length&&(r.getWorkerProgressIntervId=window.setInterval(r.updateWorkerProgress,2e3,t))},r.updateTableStatus=function(r){var t=e(f).find(h),o=e(l).data().statusName;t.find('td[data-heading="'+o+'"]').find(".qor-table__content").html(r)},r.isScrollToBottom=function(e){return e.clientHeight+e.scrollTop===e.scrollHeight},r.updateWorkerProgress=function(t){var o=t,n=e(".workers-log-output"),s=e(".qor-worker--progress-value"),i=e(".qor-worker--progress-status"),d=e(l),a=e(f).find(h),u=["killed","exception","cancelled","scheduled"];if(n.length){if(d.size())var c=d.data();if(a.size()&&c&&c.statusName)var m=a.find('td[data-heading="'+c.statusName+'"]').find(".qor-table__content").html();return d.size()&&d.size()&&-1==u.indexOf(c.status)?c.progress>=100?(window.clearInterval(r.getWorkerProgressIntervId),document.querySelector("#qor-worker--progress").MaterialProgress.setProgress(100),r.updateTableStatus(c.status),e(".qor-workers-abort").addClass("hidden"),void e(".qor-workers-rerun").removeClass("hidden")):void e.ajax({url:o,method:"GET",dataType:"html",processData:!1,contentType:!1}).done(function(t){var o=e(t),d=o.find(l).data(),a=d.progress,u=d.status;s.html(a),i.html(u),document.querySelector("#qor-worker--progress").MaterialProgress.setProgress(a);var c=e.trim(n.html()),f=e.trim(o.find(".workers-log-output").html()),h=void 0,p=o.find(".workers-error-output");f!=c&&(h=f.replace(c,""),r.isScrollToBottom(n[0])?n.append(h).scrollTop(n[0].scrollHeight):n.append(h)),p.length&&e(".workers-error-output").html(p.html()),m!=u&&r.updateTableStatus(u),a>=100&&(window.clearInterval(r.getWorkerProgressIntervId),e(".qor-workers-abort").addClass("hidden"),e(".qor-workers-rerun").removeClass("hidden"))}):void window.clearInterval(r.getWorkerProgressIntervId)}},e(function(){var t='[data-toggle="qor.workers"]';e(document).on(n,function(o){r.plugin.call(e(t,o.target),"destroy")}).on(o,function(o){r.plugin.call(e(t,o.target))}).triggerHandler(o)}),r});